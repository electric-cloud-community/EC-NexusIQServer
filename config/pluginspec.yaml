pluginInfo:
  # This is default sample specification
  # Feel free to change it
  # Call pdk showdoc pluginspec to see the list of available fields and their description
  pluginName: 'EC-NexusIQServer'
  version: '2.0.0'
  description: 'Integrates witn SonaType Nexus IQ Server reimplemented with PDK.'
  author: 'Shaohua Wen swen@cloudbees.com'
  supportUrl: 'none'
  category: 'Security'
  shell: 'ec-groovy'

# Plugin configuration description
configuration:
  # A script for checking connection will be generated
  checkConnection: 'true'
  # A set of fields will be added to process debug level in the configuration
  hasDebugLevel: true
  restConfigInfo:
    endpointLabel: 'Nexus IQ Server URL'
    endpointDescription: Specify the URL to the IQ Nexus server. e.g. http://nexus-iq-server:8070
    checkConnectionUri: '/api/v2/users'
    defaultEndpointValue: http://nexus-iq-server:8070
    headers:
      Accept: 'application/json'
    authSchemes:
      basic:
        userNameLabel: 'Username'
        passwordLabel: 'Password'
        description: 'Username and password to connect to ...'
  hasProxySupport: false
  parameters:
  -
    name: nexusJavaLocation
    documentation: Full path to java binary or a command that should be used as java. If not set "java" will be used.
    required: false
    type: entry
    label: Java Location
  -
    name: nexusCLILocation
    documentation: Specify the absolute path to the IQ Nexus CLI. For example /opt/DevSecOps/nexus-iq-cli-1.47.0-01.jar
    required: true
    type: entry
    label: Nexus CLI Location

restClient:
  userAgent: My Nexus IQ Client
  language: groovy
  endpoints:
    - methodName: getReportDetails
      httpMethod: GET
      parameters:
        - name: applicationId
          in: path
        - name: reportId
          in: path
      url: /api/v2/applications/{{applicationID}}/reports/{{reportId}}

procedures:
-
  name: 'Create Build Report'
  description: 'This procedure creates a build report using the Nexus CLI.'
  # configuration field will be generated automatically
  hasConfig: true
  parameters:
  -
    name: nexusApplicationId
    documentation: The name of the Application for which Build Report needs to be created. For example sandbox-application.
    required: true
    type: entry
    label: Application ID
  -
    name: nexusApplicationWarLocation
    documentation: Specify the absolute path to the Application WAR file. For example /opt/DevSecOps/struts2-rest-showcase-*.war
    required: true
    type: entry
    label: Application WAR Location
  outputParameters:
    Critical Violation Count: Critical Violation Count of the application
    Build Report URL:
    Violation Summary:
    License Issue Count:
    Security Issue Count:
    Component Count:
    Moderate Violation Count:
    Severe Violation Count:
